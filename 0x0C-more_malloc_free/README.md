Solutions to more malloc and free
